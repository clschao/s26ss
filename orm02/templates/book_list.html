{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{% static 'bootstrap-3.3.7-dist/css/bootstrap.min.css' %} ">
    <link rel="stylesheet" href="{% static 'tankuang/dist/sweetalert.css' %}">
</head>
<body>

<div class="container-fluid">
    <h1>查看书籍</h1>
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <a href="{% url 'book_add' %}" class="btn btn-primary">添加书籍</a>
            <table class="table table-striped table-hover table-bordered">
                <thead>
                <tr>
                    <th>编号</th>
                    <th>书名</th>
                    <th>价格</th>
                    <th>出版日期</th>
                    <th>出版社</th>
                    <th>作者</th>
                    <th>操作</th>
                </tr>
                </thead>

                <tbody>
                {% for book in all_books %}
                <tr>
                    <td class="first_child">{{ forloop.counter }}</td>
                    <td>{{ book.title }}</td>
                    <td>{{ book.price }}</td>
                    <td>{{ book.publishDate|date:'Y-m-d' }}</td>
                    <td>{{ book.publishs.name }}</td>
{#                    <td>{{ book.authors.all }}</td>#}
{#                    <td>#}
{#                        {% for author in book.authors.all %}#}
{#                            {{ author.name }}#}
{#                            {% if forloop.last %}#}
{#                                #}
{#                            {% else %}#}
{#                                ,#}
{#                            {% endif %}#}
{##}
{#                        {% endfor %}#}
{#                    #}
{#                    </td>#}
                    <td>
                        {{ book.get_all_authors }}
                    </td>
                    <td>
                        <a href="{% url 'book_edit' book.id %}" class="btn btn-warning btn-sm">编辑</a>
                        <a href="{% url 'book_del' book.id %}" class="btn btn-danger btn-sm">删除</a>
{#                        <span class="hidden">{{ book.id }}</span>#}
                        <button xxoo="{{ book.id }}" class="btn btn-danger btn-sm delete_btn">弹框删除</button>
                    </td>
                </tr>
                {% endfor %}


                </tbody>



            </table>
        </div>

    </div>


</div>


{#<iframe src="http://www.baidu.com" frameborder="0" width="1000px" height="800px">#}



{#</iframe>#}



</body>
<script src="{% static 'jquery.js' %}"></script>
<script src="{% static 'bootstrap-3.3.7-dist/js/bootstrap.min.js' %}"></script>
<script src="{% static 'tankuang/dist/sweetalert.min.js' %}"></script>

<script>

    $(".delete_btn").on("click", function () {
        // console.log($(this).attr('xxoo'));
        var ths = $(this);
      swal({
        title: "are you sure?",
        text: "滚!",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-danger",
        confirmButtonText: "再见",
        cancelButtonText: "容我三思",
        closeOnConfirm: false
        },
        function () {
          // console.log($(this));
          var deleteId = ths.attr('xxoo'); // 要删除的记录的id
          console.log('>>>>>',deleteId);
          $.ajax({
            url: "/book/swal_delete/",
            type: "post",
            data: {"id": deleteId},
            success: function (data) {
                // data --  a = {'status':1,}    a.status  a['status']
              if (data.status === 1) {
                swal("删除成功!", "你可以准备跑路了！", "success");
                // location.reload();  // 刷新页面
                  ths.parent().parent().remove();

                  var tr_first_td = $('tr .first_child');

                  for (var i=0;i<tr_first_td.length;i++){
                      // i = i+1;
                      var a = i+1;
                      $('tr .first_child').eq(i).text(a);

                  }

              } else {
                swal("删除失败", "你可以再尝试一下！", "error");
              }
            }
          })
        });
    })



</script>

</html>